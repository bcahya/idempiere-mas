<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="SalesReportBasedOnSupplier_Subreport2" language="groovy" pageWidth="802" pageHeight="555" orientation="Landscape" columnWidth="802" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="94006966-f21f-4402-b1e1-2d636ed7f308">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" hAlign="Center"/>
	<parameter name="AD_User_ID" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="DateFrom" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="DateTo" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT Master.Partner, Master.Item, SUM(Master.QtySale) AS QtySale, SUM(Master.Sale) AS Sale, SUM(Master.QtyRetur) AS QtyRetur, SUM(Master.Retur) AS Retur, Master.UOM, Master.now, Master.User FROM (SELECT bp.Name AS Partner, p.Name as Item, SUM(il.QtyEntered) AS QtySale, SUM(il.LineNetAmt) AS Sale, 0 AS QtyRetur, 0 AS Retur, uom.UOMSymbol AS UOM, now() AS now, us.Name AS User

FROM C_Invoice iv

INNER JOIN C_InvoiceLine il ON il.C_Invoice_ID = iv.C_Invoice_ID
INNER JOIN M_Product p ON p.M_Product_ID = il.M_Product_ID
INNER JOIN C_UOM uom ON uom.C_UOM_ID = p.C_UOM_ID
INNER JOIN C_BPartner_Product bpp ON bpp.M_Product_ID = p.M_Product_ID AND bpp.IsActive = 'Y'
INNER JOIN C_BPartner bp ON bp.C_BPartner_ID = bpp.C_BPartner_ID
INNER JOIN C_DocType dt ON dt.C_DocType_ID = iv.C_DocType_ID
INNER JOIN AD_User us ON us.AD_User_ID = $P{AD_User_ID}

WHERE iv.DocStatus IN ('CO', 'CL') AND iv.IsSOTrx = 'Y' AND iv.DateInvoiced BETWEEN $P{DateFrom} AND $P{DateTo} AND dt.DocBaseType = 'ARI' AND p.IsSold = 'Y' AND p.IsPurchased = 'Y'

GROUP BY bp.C_BPartner_ID, p.M_Product_ID, uom.C_UOM_ID, us.AD_User_ID

UNION ALL

SELECT bp.Name AS Partner, p.Name as Item, 0 AS QtySale, 0 AS Sale, SUM(il.QtyEntered) AS QtyRetur, SUM(il.LineNetAmt) AS Retur, uom.UOMSymbol AS UOM, now() AS now, us.Name AS User

FROM C_Invoice iv

INNER JOIN C_InvoiceLine il ON il.C_Invoice_ID = iv.C_Invoice_ID
INNER JOIN M_Product p ON p.M_Product_ID = il.M_Product_ID
INNER JOIN C_UOM uom ON uom.C_UOM_ID = p.C_UOM_ID
INNER JOIN C_BPartner_Product bpp ON bpp.M_Product_ID = p.M_Product_ID AND bpp.IsActive = 'Y'
INNER JOIN C_BPartner bp ON bp.C_BPartner_ID = bpp.C_BPartner_ID
INNER JOIN C_DocType dt ON dt.C_DocType_ID = iv.C_DocType_ID
INNER JOIN AD_User us ON us.AD_User_ID = $P{AD_User_ID}

WHERE iv.DocStatus IN ('CO', 'CL') AND iv.IsSOTrx = 'Y' AND iv.DateInvoiced BETWEEN $P{DateFrom} AND $P{DateTo} AND dt.DocBaseType = 'ARC' AND p.IsSold = 'Y' AND p.IsPurchased = 'Y'

GROUP BY bp.C_BPartner_ID, p.M_Product_ID, uom.C_UOM_ID, us.AD_User_ID) AS Master

GROUP BY Master.Partner, Master.Item, Master.UOM, Master.now, Master.User
ORDER BY TRIM(Master.Partner), Master.Item]]>
	</queryString>
	<field name="partner" class="java.lang.String"/>
	<field name="item" class="java.lang.String"/>
	<field name="qtysale" class="java.math.BigDecimal"/>
	<field name="sale" class="java.math.BigDecimal"/>
	<field name="qtyretur" class="java.math.BigDecimal"/>
	<field name="retur" class="java.math.BigDecimal"/>
	<field name="uom" class="java.lang.String"/>
	<field name="now" class="java.sql.Timestamp"/>
	<field name="user" class="java.lang.String"/>
	<variable name="qtynetto" class="java.math.BigDecimal" resetType="Column">
		<variableExpression><![CDATA[$F{qtysale}.subtract($F{qtyretur})]]></variableExpression>
	</variable>
	<variable name="nettoamount" class="java.math.BigDecimal" resetType="Column">
		<variableExpression><![CDATA[$F{sale}.subtract($F{retur})]]></variableExpression>
	</variable>
	<variable name="no" class="java.lang.Integer" calculation="Count">
		<variableExpression><![CDATA[$V{no} == null ? 1 : $V{no} + 1]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="20">
			<staticText>
				<reportElement uuid="dee66dd3-1da6-4af6-8a31-fc9e17175f6f" x="35" y="0" width="128" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Supplier]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="741cff8a-5683-4acb-a7a8-79f9a1687aec" x="163" y="0" width="231" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Item]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="71c65f5e-d3c4-42a0-9c9e-225e04ae0969" x="394" y="0" width="56" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Qty Sale]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="273ad572-3ac4-431e-861a-5e62515ba465" x="450" y="0" width="67" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Sale Amount]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="ae18a517-f28f-4dbf-8dca-b2177661ca01" x="517" y="0" width="46" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Qty Return]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="6aa1bfb0-19bd-4440-91db-f67311cb4375" x="563" y="0" width="78" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Return Amount]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="d11c4a89-a67e-4577-bc2c-98641446cb05" x="641" y="0" width="32" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[UOM]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="3958ee83-a697-4587-98fc-2e0c261dca6c" x="673" y="0" width="48" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Qty Netto]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="55cc17a3-dc25-48dc-95b7-b8cdca150a09" x="721" y="0" width="81" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Netto Amount]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="dee66dd3-1da6-4af6-8a31-fc9e17175f6f" x="0" y="0" width="35" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[No]]></text>
			</staticText>
		</band>
	</title>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement uuid="b4dd5990-c97f-44ca-9e8e-ba41be3c0196" x="35" y="0" width="128" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{partner}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="9877c5fb-1497-46db-afe3-4bf382dd496c" x="163" y="0" width="231" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{item}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="156d3ce1-d82f-451e-9bd6-24c4c690902c" x="394" y="0" width="56" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{qtysale}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="11337d17-e1bf-47d5-9cfb-9f5c7075d9fa" x="450" y="0" width="67" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{sale}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="f48ad79b-0ab1-4d8f-a16b-a4f18b42f8e8" x="517" y="0" width="46" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{qtyretur}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="12afdcd3-d449-4b44-824f-98fddcaeba1e" x="563" y="0" width="78" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{retur}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="fc13f44a-0255-4ed6-8b1c-77c19b7da39f" x="641" y="0" width="32" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{uom}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement uuid="fc13f44a-0255-4ed6-8b1c-77c19b7da39f" x="721" y="0" width="81" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{nettoamount}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement uuid="12afdcd3-d449-4b44-824f-98fddcaeba1e" x="673" y="0" width="48" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{qtynetto}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement uuid="b4dd5990-c97f-44ca-9e8e-ba41be3c0196" x="0" y="0" width="35" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{no}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
